<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Zappy: Zappy Server</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Zappy
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Zappy Server </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A server, created in C, that generates the inhabitants’ world.</p>
<h1><a class="anchor" id="autotoc_md14"></a>
Usage</h1>
<div class="fragment"><div class="line">USAGE: ./zappy_server -p port -x width -y height -n name1 name2 ... -c clientsNb -f freq</div>
<div class="line">    port        is the port number</div>
<div class="line">    width       is the width of the world</div>
<div class="line">    height      is the height of the world</div>
<div class="line">    nameX       is the name of the team X</div>
<div class="line">    clientsNb   is the number of authorized clients per team</div>
<div class="line">    freq        is the reciprocal of time unit for execution of actions</div>
</div><!-- fragment --><p>The server is executed in the form of one, single process and one, single thread. It must use select to handle socket multiplexing; the select must unlock only if something happen on a socket or if an event is ready to be executed.</p>
<blockquote class="doxtable">
<p>&zwj;The team name GRAPHIC is reserved for the GUI to authenticate itself as such to the server. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md15"></a>
AI protocol</h1>
<p>Each player responds to the following actions and only to these ones, with the following syntax :</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Action   </th><th class="markdownTableHeadCenter"><a class="el" href="classCommand.html">Command</a>   </th><th class="markdownTableHeadCenter">Time limit   </th><th class="markdownTableHeadCenter">Response    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">move up one tile   </td><td class="markdownTableBodyCenter"><b>Forward</b>   </td><td class="markdownTableBodyCenter">7/f   </td><td class="markdownTableBodyCenter">ok    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">turn 90° right   </td><td class="markdownTableBodyCenter"><b>Right</b>   </td><td class="markdownTableBodyCenter">7/f   </td><td class="markdownTableBodyCenter">ok    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">turn 90° left   </td><td class="markdownTableBodyCenter"><b>Left</b>   </td><td class="markdownTableBodyCenter">7/f   </td><td class="markdownTableBodyCenter">ok    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">look around   </td><td class="markdownTableBodyCenter"><b>Look</b>   </td><td class="markdownTableBodyCenter">7/f   </td><td class="markdownTableBodyCenter">[tile1, tile2,...]    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">inventory   </td><td class="markdownTableBodyCenter"><b>Inventory</b>   </td><td class="markdownTableBodyCenter">1/f   </td><td class="markdownTableBodyCenter">[linemate n, sibur n, ...]    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">broadcast text   </td><td class="markdownTableBodyCenter"><b>Broadcast text</b>   </td><td class="markdownTableBodyCenter">7/f   </td><td class="markdownTableBodyCenter">ok    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">number of team unused slots   </td><td class="markdownTableBodyCenter"><b>Connect_nbr</b>   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">value    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">fork a player   </td><td class="markdownTableBodyCenter"><b>Fork</b>   </td><td class="markdownTableBodyCenter">42/f   </td><td class="markdownTableBodyCenter">ok    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">eject players from this tile   </td><td class="markdownTableBodyCenter"><b>Eject</b>   </td><td class="markdownTableBodyCenter">7/f   </td><td class="markdownTableBodyCenter">ok/ko    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">death of a player   </td><td class="markdownTableBodyCenter"><em>-</em>   </td><td class="markdownTableBodyCenter">-   </td><td class="markdownTableBodyCenter">dead    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">take object   </td><td class="markdownTableBodyCenter"><b>Take object</b>   </td><td class="markdownTableBodyCenter">7/f   </td><td class="markdownTableBodyCenter">ok/ko    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">set object down   </td><td class="markdownTableBodyCenter"><b>Set object</b>   </td><td class="markdownTableBodyCenter">7/f   </td><td class="markdownTableBodyCenter">ok/ko   </td></tr>
</table>
<p>| start incantation | <b><a class="el" href="classIncantation.html">Incantation</a></b> | 300/f | Elevation underway | Current level: k/ko |</p>
<blockquote class="doxtable">
<p>&zwj;In case of a bad/unknown command, the server must answer “ko”. </p>
</blockquote>
<p>The AI client’s connection to the server happens as follows: </p><pre class="fragment">1. the client opens a socket on the server’s port,

2. the server and the client communicate the following way:
    Server --&gt; WELCOME\n
           &lt;-- TEAM-NAME\n
           --&gt; game informations (see tha above array)
</pre><p> X and Y indicate the world’s dimensions.</p>
<p>CLIENT-NUM indicates the number of slots available on the server for the TEAM-NAME team. If this number is greater than or equal to 1, a new client can connect.</p>
<blockquote class="doxtable">
<p>&zwj;The client can send up to 10 requests in a row without any response from the server. Over 10, the server will drop the incomming commands. </p>
</blockquote>
<p>The server executes the client’s requests in the order they were received.</p>
<p>The requests are buffered and a command’s execution time only blocks the player in question.</p>
<p>Trantorians have adopted an international time unit. The time unit is seconds.</p>
<p>An action’s execution time is calculated with the following formula:</p>
<p>action / f</p>
<p>Where f is an integer representing the reciprocal (multiplicative inverse) of time unit.</p>
<p>For instance, if f=1, “forward” takes 7 / 1 = 7 seconds.</p>
<p>By default f=100.</p>
<h1><a class="anchor" id="autotoc_md16"></a>
GUI protocol</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">SYMBOL   </th><th class="markdownTableHeadCenter">MEANING    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">X   </td><td class="markdownTableBodyCenter">width or horizontal position    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">Y   </td><td class="markdownTableBodyCenter">height or vertical position    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">q0   </td><td class="markdownTableBodyCenter">resource 0 (food) quantity    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">q1   </td><td class="markdownTableBodyCenter">resource 1 (linemate) quantity    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">q2   </td><td class="markdownTableBodyCenter">resource 2 (deraumere) quantity    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">q3   </td><td class="markdownTableBodyCenter">resource 3 (sibur) quantity    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">q4   </td><td class="markdownTableBodyCenter">resource 4 (mendiane) quantity    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">q5   </td><td class="markdownTableBodyCenter">resource 5 (phiras) quantity    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">q6   </td><td class="markdownTableBodyCenter">resource 6 (thystame) quantity    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">n   </td><td class="markdownTableBodyCenter">player number    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">O   </td><td class="markdownTableBodyCenter">orientation: 1(N), 2(E), 3(S), 4(W)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">L   </td><td class="markdownTableBodyCenter">player or incantation level    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">e   </td><td class="markdownTableBodyCenter">egg number    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">T   </td><td class="markdownTableBodyCenter">time unit    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">N   </td><td class="markdownTableBodyCenter">name of the team    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">R   </td><td class="markdownTableBodyCenter">incantation result    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">M   </td><td class="markdownTableBodyCenter">message    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">i   </td><td class="markdownTableBodyCenter">resource number   </td></tr>
</table>
<p><br  />
</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">SERVER   </th><th class="markdownTableHeadCenter">CLIENT   </th><th class="markdownTableHeadCenter">DETAILS   </th><th class="markdownTableHeadCenter">TO A GUI client   </th><th class="markdownTableHeadCenter">TO ALL GUI client    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">msz X Y<br  />
   </td><td class="markdownTableBodyCenter">msz<br  />
   </td><td class="markdownTableBodyCenter">map size   </td><td class="markdownTableBodyCenter">new GUI client connection or msz command   </td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">bct X Y q0 q1 q2 q3 q4 q5 q6<br  />
   </td><td class="markdownTableBodyCenter">bct X Y<br  />
   </td><td class="markdownTableBodyCenter">content of a tile   </td><td class="markdownTableBodyCenter">bct command   </td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">bct X Y q0 q1 q2 q3 q4 q5 q6<br  />
 * nbr_tiles   </td><td class="markdownTableBodyCenter">mct<br  />
   </td><td class="markdownTableBodyCenter">content of the map (all the tiles)   </td><td class="markdownTableBodyCenter">new GUI client connection or mct command or map refill   </td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">tna N<br  />
 * nbr_teams   </td><td class="markdownTableBodyCenter">tna<br  />
   </td><td class="markdownTableBodyCenter">name of all the teams   </td><td class="markdownTableBodyCenter">new GUI client connection   </td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">pnw #n X Y O L N<br  />
   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">connection of a new player   </td><td class="markdownTableBodyCenter">new GUI client connection   </td><td class="markdownTableBodyCenter">new AI client connection    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">ppo #n X Y O<br  />
   </td><td class="markdownTableBodyCenter">ppo #n<br  />
   </td><td class="markdownTableBodyCenter">player’s position   </td><td class="markdownTableBodyCenter">ppo command   </td><td class="markdownTableBodyCenter">AI left, right forward action or AI is ejected    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">plv #n L<br  />
   </td><td class="markdownTableBodyCenter">plv #n<br  />
   </td><td class="markdownTableBodyCenter">player’s level   </td><td class="markdownTableBodyCenter">new GUI client connection or plv command   </td><td class="markdownTableBodyCenter">AI sucessfully incantate    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">pin #n X Y q0 q1 q2 q3 q4 q5 q6<br  />
   </td><td class="markdownTableBodyCenter">pin #n<br  />
   </td><td class="markdownTableBodyCenter">player’s inventory   </td><td class="markdownTableBodyCenter">new GUI client connection or pin command   </td><td class="markdownTableBodyCenter">new AI client connection or AI set, take action or AI lost food    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">pex #n<br  />
   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">expulsion   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">AI eject action    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">pbc #n M<br  />
   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">broadcast   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">AI broadcast action    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">pic X Y L #n #n ...<br  />
   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">start of an incantation (by the first player)   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">AI incantation action    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">pie X Y R<br  />
   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">end of an incantation   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">AI incatation end    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">pfk #n<br  />
   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">egg laying by the player   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">AI fork action    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">pdr #n i<br  />
   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">resource dropping   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">AI set action    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">pgt #n i<br  />
   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">resource collecting   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">AI take action    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">pdi #n<br  />
   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">death of a player   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">AI client disconnection or AI lost all it's food    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">enw #e #n X Y<br  />
   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">an egg was laid by a player   </td><td class="markdownTableBodyCenter">new GUI client connection   </td><td class="markdownTableBodyCenter">AI fork action end (after 42/f)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">ebo #e<br  />
   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">player connection for an egg   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">new AI client connection    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">edi #e<br  />
   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">death of an egg   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">egg is ejected by an AI    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">sgt T<br  />
   </td><td class="markdownTableBodyCenter">sgt<br  />
   </td><td class="markdownTableBodyCenter">time unit request   </td><td class="markdownTableBodyCenter">new GUI client connection or sgt   </td><td class="markdownTableBodyCenter">sst command    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">sst T<br  />
   </td><td class="markdownTableBodyCenter">sst T<br  />
   </td><td class="markdownTableBodyCenter">time unit modification   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">seg N<br  />
   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">end of game   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">an AI team reach the victory conditions    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">smg M<br  />
   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">message from the server   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">server send a message    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">suc<br  />
   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">unknown command   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">empty or unknown command    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">sbp<br  />
   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">command parameter   </td><td class="markdownTableBodyCenter"></td><td class="markdownTableBodyCenter">invalid command (wrong parameter.s)   </td></tr>
</table>
<p><br  />
</p>
<p>The GUI client’s connection to the server happens as follows: </p><pre class="fragment">1. the client opens a socket on the server’s port,

2. the server and the client communicate the following way:
    Server --&gt; WELCOME\n
           &lt;-- GRAPHIC\n
           --&gt; game informations (see the above array)
</pre><h1><a class="anchor" id="autotoc_md17"></a>
Informations</h1>
<h2><a class="anchor" id="autotoc_md18"></a>
Incantations</h2>
<p>This ritual, which augments physical and mental capacities, must be done according to a particular rite: they must gather the following on the same unit of terrain:</p>
<ul>
<li>At least a certain number of each stones</li>
<li>At least a certain number of players with the same level</li>
</ul>
<p>The elevation begins as soon as a player initiates the incantation. The player who starts an incantation will receive ko if all the requirements are not satisfied and the incantation will be canceled, the player will receive the ko instantly after the initial server check (not at the end of the incantation duration).</p>
<p>It is not necessary for the players to be on the same team; they only need to be of the same level. Every player with the corresponding level and present at the beginning and at the end of the incantation attain the higher level.</p>
<p>During the incantation, the participants can not make any action until the end of the rite.</p>
<p>At the end of the incantation, the exact quantity of resources needed by the rite are consumed.</p>
<h1><a class="anchor" id="autotoc_md19"></a>
Add New Commands</h1>
<p><br  />
 </p><pre class="fragment">## Code of the function in the /commands directory

To implement new function you need to repest this format :

void command_NAME(client_t *client, server_t *server, char *cmd)
{
char *response;

**Behavor of the function ***

if (server-&gt;gui != NULL) {                                  |
    if (asprintf(&amp;response, "NAME PARAMS\n",                |   This part is neccessary to link the server
        Param) &lt; 0)                                         |   to the Gui to get all the update dans decide
        return;                                             |   the behavor of the player / object on the
    send_to_client(server, server-&gt;gui, response);          |   map
    free(response);                                         |
}
send_to_client(server, client, "ok\n");
}

## Implementation of the function

const tab_t tab_command[] = {
    {"msz", command_msz, 0},
    {"bct", command_bct, 0},
    ...
    {"Incantation", command_incantation, 300},
    {"Fork", command_fork, 42}
};
|    Call in server|  function name    | tick |
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
